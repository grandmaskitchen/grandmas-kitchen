<script>
// --- Prefill editor when ?product_num=... is present ---
(function () {
  const params = new URLSearchParams(location.search);
  const slug = params.get('product_num');
  if (!slug) return;

  (async () => {
    try {
      const r = await fetch('/api/admin/product-get?product_num=' + encodeURIComponent(slug));
      const { product, error } = await r.json();
      if (!r.ok || !product) throw new Error(error || 'Not found');

      // Fill fields (only set if empty so you can overwrite)
      const set = (id, val) => { const el = document.getElementById(id); if (el && (el.value==='' || el.value==null)) el.value = val || ''; };
      set('my_title', product.my_title);
      set('my_subtitle', product.my_subtitle);
      set('my_description_short', product.my_description_short);
      set('my_description_long', product.my_description_long);
      set('affiliate_link', product.affiliate_link);
      set('amazon_title', product.amazon_title);
      set('amazon_desc', product.amazon_desc);
      set('amazon_category', product.amazon_category);
      set('image_main', product.image_main);
      set('image_small', product.image_small);
      set('image_extra_1', product.image_extra_1);
      set('image_extra_2', product.image_extra_2);
      set('where_advertised', product.where_advertised);
      set('ad_type', product.ad_type);
      set('product_type', product.product_type);
      set('commission_l', product.commission_l);
      set('manufacturer', product.manufacturer);
      set('product_num', product.product_num); // keep slug visible/editable if you want

      // FAB fields
      set('features', product.features);
      set('advantages', product.advantages);
      set('benefits', product.benefits);

      const chk = document.getElementById('approved');
      if (chk) chk.checked = !!product.approved;

      // Mark submit button as Update
      const btn = document.querySelector('button[type="submit"]');
      if (btn) btn.textContent = 'Update';
    } catch (e) {
      console.warn('Prefill failed:', e);
    }
  })();
})();
</script>
