<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Grandma’s Kitchen</title>

  <!-- CSS -->
  <link rel="preload" href="/style.css" as="style">
  <link rel="stylesheet" href="/style.css">

  <!-- RSS for Today’s Picks -->
  <link rel="alternate" type="application/rss+xml"
        title="Grandma’s Kitchen • Daily Picks"
        href="/app/home-picks.rss" />
</head>
<body>

<header class="container center">
  <a href="/index.html">
    <img src="/images/logo.jpg" alt="Grandma’s Kitchen Logo" style="max-height:100px;margin-bottom:1rem;">
  </a>

  <h1>Grandma’s Kitchen</h1>
  <nav aria-label="Primary">
    <a href="/">Home</a> |
    <a href="/about.html">About</a> |
    <a href="/recipes.html">Recipes</a> |
    <a href="/shop.html">Shop</a>
  </nav>
  <p>Simple food. Lifelong health. Inspired by a 104-year legacy.</p>
</header>

<section class="container" aria-labelledby="daily-picks-title">
  <h2 id="daily-picks-title">Today’s Picks</h2>
  <div id="homePicks" class="grid grid-2">
    <!-- optional tiny skeletons while loading -->
    <article class="card"><div class="skeleton img"></div><div class="skeleton text" style="width:70%"></div></article>
    <article class="card"><div class="skeleton img"></div><div class="skeleton text" style="width:60%"></div></article>
  </div>
</section>

<script>
(async function () {
  const box = document.getElementById('homePicks');
  if (!box) return;

  const esc = s => (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]));

  try {
    // JSON comes from /functions/api/home-picks.js
    const r = await fetch('/api/home-picks');
    const { items, error } = await r.json();
    if (!r.ok || !Array.isArray(items)) throw new Error(error || 'Failed to load');

    if (!items.length) {
      box.innerHTML = `<p class="muted">No picks yet.</p>`;
      return;
    }

    box.innerHTML = items.map(p => {
      const title = p.my_title || p.amazon_title || 'Product';
      const img = p.image_main || '';
      const slug = p.product_num || '';
      const url  = `/products/${encodeURIComponent(slug)}`;

      return `
        <article class="card" aria-labelledby="pick-${esc(slug)}">
          <a class="product-image" href="${esc(url)}">
            ${img ? `<img loading="lazy" decoding="async" src="${esc(img)}" alt="${esc(title)}">` : ''}
          </a>
          <h3 id="pick-${esc(slug)}" class="product-title">
            <a href="${esc(url)}">${esc(title)}</a>
          </h3>
          <p><a class="btn" href="${esc(url)}">View product</a></p>
        </article>
      `;
    }).join('');
  } catch (err) {
    console.error(err);
    box.innerHTML = `<p class="muted">Sorry, today’s picks are unavailable.</p>`;
  }
})();
</script>

</body>
</html>
